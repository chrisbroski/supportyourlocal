<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Previous Shows</title>
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
<link rel="stylesheet" type="text/css" href="/inc/main.css">

<body>

<!--#include file="/api/header.pht" -->

<main>
<article id="past-shows">
    <section class="col2">
        <h1>Previous Shows</h1>
        <div>
            <p><a href="/shows" class="more">Upcoming Shows</a></p>
        </div>
        <div>
            <img src="/photos/image0000081.jpg">
        </div>
    </section>
</article>
</main>

<script type="text/javascript" src="/inc/Aerophane.js"></script>
<script type="text/javascript" src="/inc/main.js"></script>
<script>

function showGigs(gigData) {
    var shows = document.querySelector("#past-shows");
    var section;
    var year;
    var h2;

    gigData.gigs.forEach(function (gig) {
        var h3;
        var p;
        var date = new Date(gig.date + "T00:00:01");
        var mapLink;
        var thisYear = (new Date()).getFullYear();

        if (year !== date.getFullYear()) {
            if (!!section) {
                shows.appendChild(section);
            }
            section = document.createElement("section");
            h2 = document.createElement("h2");
            if (!year) {
                year = date.getFullYear();
                if (date.getFullYear() !== thisYear) {
                    h2.textContent = year;
                    section.appendChild(h2);
                }
            } else {
                year = date.getFullYear();
                h2.textContent = year;
                section.appendChild(h2);
            }
        }

        h3 = document.createElement("h4");
        if (gig.title) {
            h3.textContent = gig.title + " - ";
        }

        h3.appendChild(document.createTextNode(`${months[date.getMonth()]} ${date.getDate()}`));
        h3.appendChild(ord(date.getDate()));
        h3.appendChild(document.createTextNode(`, ${date.getFullYear()} - `));
        h3.appendChild(document.createTextNode(gig.venueData.name));

        p = document.createElement("span");
        p.textContent = " " + daysOfTheWeek[date.getDay()] + ", " + gigTimes(gig.date, gig.startTime, gig.durationH, gig.durationM) + " ";

        mapLink = document.createElement("a");
        mapLink.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(gig.venueData.name)}%2C+${encodeURIComponent(gig.venueData.city)}+${encodeURIComponent(gig.venueData.state)}}`;
        mapLink.textContent = `${gig.venueData.city}, ${gig.venueData.state}`;
        p.appendChild(mapLink);
        h3.appendChild(p);
        section.appendChild(h3);
    });

    shows.appendChild(section);
}

setTitle();
getJsonData("/api/gig/?range=past", showGigs);
</script>
